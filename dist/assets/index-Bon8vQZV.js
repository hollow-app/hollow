var Se=Object.defineProperty;var Ce=(e,r,t)=>r in e?Se(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var X=(e,r,t)=>Ce(e,typeof r!="symbol"?r+"":r,t);import{c as k,m as W,I as V,b as R,o as H,G as U,p as B,ac as se,z as J,Y as _e,t as N,i as _,S as Q,F as ge,ad as Ee,k as q,B as ve,E as me,l as Me,q as be,x as Ae,s as fe,U as Oe,Q as ye,w as he,J as K,ae as O,af as xe,H as Z,ag as Te,ah as pe,n as G,f as Pe,V as je}from"./index-CNe0vCeo.js";import{T as Ke}from"./Tag-B9bolLc4.js";var Ne=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ge=e=>k(V,W(e,{iconNode:Ne,name:"check-check"})),Le=Ge,qe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Fe=e=>k(V,W(e,{iconNode:qe,name:"circle-plus"})),ze=Fe,Re=[["path",{d:"M12 6v6l-4 2",key:"imc3wl"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Be=e=>k(V,W(e,{iconNode:Re,name:"clock-8"})),Ye=Be,Ue=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],We=e=>k(V,W(e,{iconNode:Ue,name:"ellipsis-vertical"})),Xe=We,Ve=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],He=e=>k(V,W(e,{iconNode:Ve,name:"send"})),ke=He;const Je=(e,r)=>{let t;const[o,s]=R(e.data),[l,i]=R(null),[u,c]=R([]),[v,m]=R((r==null?void 0:r.toolEvents.getData("metadata")).cards.find(y=>y.data.name===e.card.data.name));return{listDiv:t,kanban:o,setKanban:s,activeItem:l,setActiveItem:i,selectedGroup:u,setSelectedGroup:c,meta:v,setMeta:m}},Qe=(e,r,t)=>{const o=b=>{e.setKanban(a=>({...a,items:a.items.map(g=>g.id===b.id?b:g)})),p()},s=b=>{e.setKanban(a=>({...a,items:a.items.filter(g=>g.id!==b)})),p()},l=b=>{e.kanban().items.length/e.kanban().max<1&&(e.setKanban(a=>({...a,items:[...a.items,b]})),p())},i=({draggable:b})=>e.setActiveItem(String(b.id)),u=({draggable:b,droppable:a})=>{if(b&&a){const g=e.kanban().items,E=g.findIndex(I=>I.id===String(b.id)),D=g.findIndex(I=>I.id===String(a.id));if(E!==D){const I=[...g];I.splice(D,0,I.splice(E,1)[0]),e.setKanban(C=>({...C,items:[...I]})),p()}}},c=()=>{const b={tool:"Kanban",card:r.card.data.name,save:()=>{p()},options:[{type:"text",label:"Title",description:"Change Column Title",value:e.kanban().name,onAction:a=>e.setKanban(g=>({...g,name:a}))},{type:"color",label:"Accent Color",description:"Change The Column's Accent Color",value:e.kanban().accent,onAction:a=>e.setKanban(g=>({...g,accent:a}))},{type:"number",label:"Max Items",description:"Max Number of items",value:e.kanban().max,onAction:a=>e.setKanban(g=>({...g,max:a}))}]};B.events.emit("tool-settings",b)},v=b=>{e.setKanban(a=>({...a,items:[...a.items,...b]})),p()},m=()=>{e.setKanban(b=>({...b,items:b.items.filter(a=>!e.selectedGroup().includes(a.id))}))},y=()=>{if(e.kanban().items.length>0){const b=[{icon:J({name:"menu-board-outline"}),label:"Stats",onclick:()=>se.getSelf().showInsight(e.kanban())},{icon:Le,label:"Select All",onclick:()=>e.setSelectedGroup(e.kanban().items.map(g=>g.id))},...e.selectedGroup().length>0?[{icon:_e,label:"UnSelect All",onclick:()=>e.setSelectedGroup([])}]:[]];if(e.selectedGroup().length>0){const g=e.selectedGroup().length,E=t==null?void 0:t.toolEvents.getData("metadata");E.cards.some(D=>D.data.name!==r.card.data.name)&&b.push({icon:ke,label:`Send (${g})`,children:E.cards.filter(D=>D.data.name!==r.card.data.name&&D.data.isPlaced).map(D=>({label:`${D.data.emoji} ${D.data.name}`,onclick:()=>{t==null||t.toolEvents.emit(`${D.data.name}-receive-task`,e.kanban().items.filter(I=>e.selectedGroup().includes(I.id))),m(),p(),e.setSelectedGroup([])}}))}),b.push({icon:J({name:"trash-outline"}),label:`Delete (${g})`,onclick:()=>{B.events.emit("confirm",{title:"Warning",message:`You sure you want to remove (${g}) items`,onAccept:()=>{m(),p(),e.setSelectedGroup([])}})}})}const a={id:`kanban-column-${e.kanban().id}`,header:"Kanban",items:b};B.events.emit("context-menu-extend",a)}},S=(b,a)=>{const g=!!a,E={id:(a==null?void 0:a.id)??crypto.randomUUID(),title:g?"Update Item":"New Item",update:g,options:[{key:"title",type:"text",label:"Title",attributes:{placeholder:"Enter Title"},inline:!0,value:(a==null?void 0:a.title)??""},{key:"priority",type:"segmented",label:"Priority",inline:!0,options:[{key:"low",title:"low"},{key:"medium",title:"medium"},{key:"high",title:"high"},{key:"urgent",title:"urgent"}],value:(a==null?void 0:a.priority)??"medium"},{key:"content",type:"longtext",label:"Content",attributes:{placeholder:"Enter Content"},value:(a==null?void 0:a.content)??""},{key:"progress",type:"range",label:"Progress",row:!0,min:0,max:100,value:(a==null?void 0:a.progress)??0},{key:"tags",type:"keywords",label:"Tags",placeholder:"Enter tags",value:(a==null?void 0:a.tags)??[]}],submit:b};B.events.emit("form",E)},p=()=>{se.getSelf().saveColumn(e.kanban())},w=b=>{const a=b.cards.find(g=>g.data.name===r.card.data.name);a&&e.setMeta(a)};return H(()=>{t==null||t.toolEvents.on(`${r.card.id}-settings`,c),t==null||t.toolEvents.on(`${r.card.data.name}-receive-task`,v),t==null||t.toolEvents.on("metadata",w)}),U(()=>{t==null||t.toolEvents.off(`${r.card.id}-settings`,c),t==null||t.toolEvents.off(`${r.card.data.name}-receive-task`,v),t==null||t.toolEvents.off("metadata",w)}),{handleContextMenu:y,addItem:l,showForm:S,onDragEnd:u,onDragStart:i,updateItem:o,removeItem:s}};var Ze=N('<div class="flex flex-wrap gap-1.5 px-2"style=font-size:0.8rem>'),et=N('<div style=line-height:normal;border-color:var(--color-secondary-20)><div><div class="border-secondary-15 flex justify-between border-b border-dashed p-2 text-sm"><p class="truncate text-lg font-medium"></p></div><p class="p-2 text-xs text-neutral-600 dark:text-neutral-400"></p><div class="flex items-center px-2 pt-3 pb-2"><div class="relative size-3"><svg class="size-full -rotate-90"viewBox="0 0 36 36"xmlns=http://www.w3.org/2000/svg><circle cx=18 cy=18 r=14 fill=none class="text-secondary-20 stroke-current"stroke-width=6></circle><circle cx=18 cy=18 r=14 class="text-secondary-50 stroke-current"fill=none stroke-width=6 stroke-dasharray=100 stroke-linecap=round></circle></svg></div><span class="pl-0.5 text-xs font-medium text-neutral-600 dark:text-neutral-400">%</span><span class="border-secondary-10 ml-2 border-l pl-2 text-xs font-medium"></span><div class="ml-auto flex items-center text-neutral-500"><span class="pl-0.5 text-xs font-medium text-neutral-600 dark:text-neutral-400">');function Ie(e){return(()=>{var r=et(),t=r.firstChild,o=t.firstChild,s=o.firstChild,l=o.nextSibling,i=l.nextSibling,u=i.firstChild,c=u.firstChild,v=c.firstChild,m=v.nextSibling,y=u.nextSibling,S=y.firstChild,p=y.nextSibling,w=p.nextSibling,b=w.firstChild;return _(s,()=>e.item.title),_(o,k(Q,{get when(){return e.headerContent},get children(){return e.headerContent}}),null),_(l,()=>e.item.content),_(t,k(Q,{get when(){return e.item.tags.length>0},get children(){var a=Ze();return _(a,k(ge,{get each(){return e.item.tags},children:g=>k(Ke,{tag:g})})),a}}),i),_(y,()=>e.item.progress,S),_(p,()=>e.item.priority),_(w,k(Ye,{class:"size-3"}),b),_(b,()=>Ee(e.item.dates.createdAt)),q(a=>{var g=`group bg-secondary-05 relative box-border h-fit w-full rounded-xl border text-black shadow-md dark:text-white ${e.containerClass}`,E={...e.containerStyle},D=100-e.item.progress,I=e.item.priority==="low",C=e.item.priority==="medium",j=e.item.priority==="high",L=e.item.priority==="urgent";return g!==a.e&&ve(r,a.e=g),a.t=me(r,E,a.t),D!==a.a&&Me(m,"stroke-dashoffset",a.a=D),I!==a.o&&p.classList.toggle("text-green-400",a.o=I),C!==a.i&&p.classList.toggle("text-yellow-400",a.i=C),j!==a.n&&p.classList.toggle("text-orange-400",a.n=j),L!==a.s&&p.classList.toggle("text-red-400",a.s=L),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),r})()}var tt=N("<div>"),rt=N('<div class="opacity-0 transition-opacity group-hover:opacity-100"><input type=checkbox class=checkbox style=--margin:0>');function at(e){const r=Ae(()=>e.selectedGroup().includes(e.item.id)),t=()=>{e.setSelectedGroup(s=>s.includes(e.item.id)?s.filter(l=>l!==e.item.id):[...s,e.item.id])},o=()=>{const l=e.toolEvent.getData("metadata").cards.filter(c=>c.data.name!==e.cardName&&c.data.isPlaced).map(c=>({label:`${c.data.emoji} ${c.data.name}`,onclick:()=>{e.toolEvent.emit(`${c.data.name}-receive-task`,[e.item]),e.removeItem(e.item.id)}})),i=[{icon:J({name:"edit-pen-outline"}),label:"Edit",onclick:()=>{e.showForm(c=>{e.updateItem({...e.item,...c})},e.item)}},{icon:J({name:"trash-outline"}),label:"Delete",onclick:()=>e.removeItem(e.item.id,!0)}];l.length>0&&i.unshift({icon:ke,label:"Send",children:l});const u={id:`kanban-item-cm-${e.item.id}`,header:"Task",items:i};B.events.emit("context-menu-extend",u)};return(()=>{var s=tt();return s.$$click=l=>l.ctrlKey&&t(),s.$$contextmenu=o,_(s,k(Ie,{get item(){return e.item},get containerStyle(){return{"border-color":r()?e.accentColor:"var(--color-secondary-10)"}},get headerContent(){return(()=>{var l=rt(),i=l.firstChild;return i.$$click=t,q(u=>{var m;var c=!!((m=e.selectedGroup())!=null&&m.includes(e.item.id)),v=e.accentColor;return c!==u.e&&l.classList.toggle("opacity-100",u.e=c),v!==u.t&&fe(i,"--accent-color",u.t=v),u},{e:void 0,t:void 0}),q(()=>i.checked=r()),l})()}})),q(l=>Oe(s,{"cursor-pointer select-none":e.isActive},l)),s})()}be(["contextmenu","click"]);var nt=N("<div>"),ee=class{constructor(e){X(this,"x");X(this,"y");X(this,"width");X(this,"height");this.x=Math.floor(e.x),this.y=Math.floor(e.y),this.width=Math.floor(e.width),this.height=Math.floor(e.height)}get rect(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get center(){return{x:this.x+this.width*.5,y:this.y+this.height*.5}}get corners(){return{topLeft:{x:this.left,y:this.top},topRight:{x:this.right,y:this.top},bottomRight:{x:this.left,y:this.bottom},bottomLeft:{x:this.right,y:this.bottom}}}},Y=e=>{let r=new ee(e.getBoundingClientRect());const{transform:t}=getComputedStyle(e);return t&&(r=ot(r,t)),r},ot=(e,r)=>{let t,o;if(r.startsWith("matrix3d(")){const s=r.slice(9,-1).split(/, /);t=+s[12],o=+s[13]}else if(r.startsWith("matrix(")){const s=r.slice(7,-1).split(/, /);t=+s[4],o=+s[5]}else t=0,o=0;return new ee({...e,x:e.x-t,y:e.y-o})},P=()=>({x:0,y:0}),le=(e,r)=>e.x===r.x&&e.y===r.y,ne=(e,r)=>new ee({...e,x:e.x+r.x,y:e.y+r.y}),st=(e,r)=>Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),lt=(e,r)=>{const t=Math.max(e.top,r.top),o=Math.max(e.left,r.left),s=Math.min(e.right,r.right),l=Math.min(e.bottom,r.bottom),i=s-o,u=l-t;if(o<s&&t<l){const c=e.width*e.height,v=r.width*r.height,m=i*u;return m/(c+v-m)}return 0},oe=(e,r)=>e.x===r.x&&e.y===r.y&&e.width===r.width&&e.height===r.height,it=(e,r,t)=>{const o=e.transformed.center,s={distance:1/0,droppable:null};for(const l of r){const i=st(o,l.layout.center);i<s.distance?(s.distance=i,s.droppable=l):i===s.distance&&l.id===t.activeDroppableId&&(s.droppable=l)}return s.droppable},ct=(e,r,t)=>{const o=e.transformed,s={ratio:0,droppable:null};for(const l of r){const i=lt(o,l.layout);i>s.ratio?(s.ratio=i,s.droppable=l):i>0&&i===s.ratio&&l.id===t.activeDroppableId&&(s.droppable=l)}return s.droppable},we=xe(),dt=e=>{const r=W({collisionDetector:ct},e),[t,o]=he({draggables:{},droppables:{},sensors:{},active:{draggableId:null,get draggable(){return t.active.draggableId!==null?t.draggables[t.active.draggableId]:null},droppableId:null,get droppable(){return t.active.droppableId!==null?t.droppables[t.active.droppableId]:null},sensorId:null,get sensor(){return t.active.sensorId!==null?t.sensors[t.active.sensorId]:null},overlay:null}}),s=(n,d,f)=>{n.substring(0,n.length-1),O(()=>t[n][d])&&o(n,d,"transformers",f.id,f)},l=(n,d,f)=>{n.substring(0,n.length-1),O(()=>t[n][d])&&O(()=>t[n][d].transformers[f])&&o(n,d,"transformers",f,void 0)},i=({id:n,node:d,layout:f,data:A})=>{const h=t.draggables[n],x={id:n,node:d,layout:f,data:A,_pendingCleanup:!1};let $;if(!h)Object.defineProperties(x,{transformers:{enumerable:!0,configurable:!0,writable:!0,value:{}},transform:{enumerable:!0,configurable:!0,get:()=>{if(t.active.overlay)return P();const M=Object.values(t.draggables[n].transformers);return M.sort((T,z)=>T.order-z.order),M.reduce((T,z)=>z.callback(T),P())}},transformed:{enumerable:!0,configurable:!0,get:()=>ne(t.draggables[n].layout,t.draggables[n].transform)}});else if(t.active.draggableId===n&&!t.active.overlay){const M={x:h.layout.x-f.x,y:h.layout.y-f.y},T="addDraggable-existing-offset",z=h.transformers[T],de=z?z.callback(M):M;$={id:T,order:100,callback:ue=>({x:ue.x+de.x,y:ue.y+de.y})},ae(()=>l("draggables",n,T))}G(()=>{o("draggables",n,x),$&&s("draggables",n,$)}),t.active.draggable&&I()},u=n=>{O(()=>t.draggables[n])&&(o("draggables",n,"_pendingCleanup",!0),queueMicrotask(()=>c(n)))},c=n=>{var d;if((d=t.draggables[n])!=null&&d._pendingCleanup){const f=t.active.draggableId===n;G(()=>{f&&o("active","draggableId",null),o("draggables",n,void 0)})}},v=({id:n,node:d,layout:f,data:A})=>{const h=t.droppables[n],x={id:n,node:d,layout:f,data:A,_pendingCleanup:!1};h||Object.defineProperties(x,{transformers:{enumerable:!0,configurable:!0,writable:!0,value:{}},transform:{enumerable:!0,configurable:!0,get:()=>{const $=Object.values(t.droppables[n].transformers);return $.sort((M,T)=>M.order-T.order),$.reduce((M,T)=>T.callback(M),P())}},transformed:{enumerable:!0,configurable:!0,get:()=>ne(t.droppables[n].layout,t.droppables[n].transform)}}),o("droppables",n,x),t.active.draggable&&I()},m=n=>{O(()=>t.droppables[n])&&(o("droppables",n,"_pendingCleanup",!0),queueMicrotask(()=>y(n)))},y=n=>{var d;if((d=t.droppables[n])!=null&&d._pendingCleanup){const f=t.active.droppableId===n;G(()=>{f&&o("active","droppableId",null),o("droppables",n,void 0)})}},S=({id:n,activators:d})=>{o("sensors",n,{id:n,activators:d,coordinates:{origin:{x:0,y:0},current:{x:0,y:0},get delta(){return{x:t.sensors[n].coordinates.current.x-t.sensors[n].coordinates.origin.x,y:t.sensors[n].coordinates.current.y-t.sensors[n].coordinates.origin.y}}}})},p=n=>{if(!O(()=>t.sensors[n]))return;const d=t.active.sensorId===n;G(()=>{d&&o("active","sensorId",null),o("sensors",n,void 0)})},w=({node:n,layout:d})=>{const f=t.active.overlay,A={node:n,layout:d};f||Object.defineProperties(A,{id:{enumerable:!0,configurable:!0,get:()=>{var h;return(h=t.active.draggable)==null?void 0:h.id}},data:{enumerable:!0,configurable:!0,get:()=>{var h;return(h=t.active.draggable)==null?void 0:h.data}},transformers:{enumerable:!0,configurable:!0,get:()=>Object.fromEntries(Object.entries(t.active.draggable?t.active.draggable.transformers:{}).filter(([h])=>h!=="addDraggable-existing-offset"))},transform:{enumerable:!0,configurable:!0,get:()=>{const h=Object.values(t.active.overlay?t.active.overlay.transformers:[]);return h.sort((x,$)=>x.order-$.order),h.reduce((x,$)=>$.callback(x),P())}},transformed:{enumerable:!0,configurable:!0,get:()=>t.active.overlay?ne(t.active.overlay.layout,t.active.overlay.transform):new ee({x:0,y:0,width:0,height:0})}}),o("active","overlay",A)},b=()=>o("active","overlay",null),a=(n,d)=>{G(()=>{o("sensors",n,"coordinates",{origin:{...d},current:{...d}}),o("active","sensorId",n)})},g=n=>{const d=t.active.sensorId;d&&o("sensors",d,"coordinates","current",{...n})},E=()=>o("active","sensorId",null),D=(n,d)=>{const f={};for(const h of Object.values(t.sensors))if(h)for(const[x,$]of Object.entries(h.activators))f[x]??(f[x]=[]),f[x].push({sensor:h,activator:$});const A={};for(const h in f){let x=h;d&&(x=`on${h}`),A[x]=$=>{for(const{activator:M}of f[h]){if(t.active.sensor)break;M($,n)}}}return A},I=()=>{let n=!1;const d=Object.values(t.draggables),f=Object.values(t.droppables),A=t.active.overlay;return G(()=>{const h=new WeakMap;for(const x of d)if(x){const $=x.layout;h.has(x.node)||h.set(x.node,Y(x.node));const M=h.get(x.node);oe($,M)||(o("draggables",x.id,"layout",M),n=!0)}for(const x of f)if(x){const $=x.layout;h.has(x.node)||h.set(x.node,Y(x.node));const M=h.get(x.node);oe($,M)||(o("droppables",x.id,"layout",M),n=!0)}if(A){const x=A.layout,$=Y(A.node);oe(x,$)||(o("active","overlay","layout",$),n=!0)}}),n},C=()=>{const n=t.active.overlay??t.active.draggable;if(n){const d=r.collisionDetector(n,Object.values(t.droppables),{activeDroppableId:t.active.droppableId}),f=d?d.id:null;t.active.droppableId!==f&&o("active","droppableId",f)}},j=n=>{const d={id:"sensorMove",order:0,callback:f=>t.active.sensor?{x:f.x+t.active.sensor.coordinates.delta.x,y:f.y+t.active.sensor.coordinates.delta.y}:f};I(),G(()=>{o("active","draggableId",n),s("draggables",n,d)}),C()},L=()=>{const n=O(()=>t.active.draggableId);G(()=>{n!==null&&l("draggables",n,"sensorMove"),o("active",["draggableId","droppableId"],null)}),I()},ie=n=>{K(()=>{const d=t.active.draggable;d&&O(()=>n({draggable:d}))})},re=n=>{K(()=>{const d=t.active.draggable;if(d){const f=O(()=>t.active.overlay);Object.values(f?f.transform:d.transform),O(()=>n({draggable:d,overlay:f}))}})},ce=n=>{K(()=>{const d=t.active.draggable,f=t.active.droppable;d&&O(()=>n({draggable:d,droppable:f,overlay:t.active.overlay}))})},ae=n=>{K(({previousDraggable:d,previousDroppable:f,previousOverlay:A})=>{const h=t.active.draggable,x=h?t.active.droppable:null,$=h?t.active.overlay:null;return!h&&d&&O(()=>n({draggable:d,droppable:f,overlay:A})),{previousDraggable:h,previousDroppable:x,previousOverlay:$}},{previousDraggable:null,previousDroppable:null,previousOverlay:null})};re(()=>C()),r.onDragStart&&ie(r.onDragStart),r.onDragMove&&re(r.onDragMove),r.onDragOver&&ce(r.onDragOver),r.onDragEnd&&ae(r.onDragEnd);const $e=[t,{addTransformer:s,removeTransformer:l,addDraggable:i,removeDraggable:u,addDroppable:v,removeDroppable:m,addSensor:S,removeSensor:p,setOverlay:w,clearOverlay:b,recomputeLayouts:I,detectCollisions:C,draggableActivators:D,sensorStart:a,sensorMove:g,sensorEnd:E,dragStart:j,dragEnd:L,onDragStart:ie,onDragMove:re,onDragOver:ce,onDragEnd:ae}];return k(we.Provider,{value:$e,get children(){return r.children}})},F=()=>pe(we)||null,ut=(e="pointer-sensor")=>{const[r,{addSensor:t,removeSensor:o,sensorStart:s,sensorMove:l,sensorEnd:i,dragStart:u,dragEnd:c}]=F(),v=250,m=10;H(()=>{t({id:e,activators:{pointerdown:b}})}),U(()=>{o(e)});const y=()=>r.active.sensorId===e,S={x:0,y:0};let p=null,w=null;const b=(C,j)=>{C.button===0&&(document.addEventListener("pointermove",E),document.addEventListener("pointerup",D),w=j,S.x=C.clientX,S.y=C.clientY,p=window.setTimeout(g,v))},a=()=>{p&&(clearTimeout(p),p=null),document.removeEventListener("pointermove",E),document.removeEventListener("pointerup",D),document.removeEventListener("selectionchange",I)},g=()=>{r.active.sensor?y()||a():(s(e,S),u(w),I(),document.addEventListener("selectionchange",I))},E=C=>{const j={x:C.clientX,y:C.clientY};if(!r.active.sensor){const L={x:j.x-S.x,y:j.y-S.y};Math.sqrt(L.x**2+L.y**2)>m&&g()}y()&&(C.preventDefault(),l(j))},D=C=>{a(),y()&&(C.preventDefault(),c(),i())},I=()=>{var C;(C=window.getSelection())==null||C.removeAllRanges()}},gt=e=>(ut(),ye(()=>e.children)),te=e=>({transform:`translate3d(${e.x}px, ${e.y}px, 0)`}),vt=(e,r={})=>{const[t,{addDraggable:o,removeDraggable:s,draggableActivators:l}]=F(),[i,u]=R(null);H(()=>{const y=i();y&&o({id:e,node:y,layout:Y(y),data:r})}),U(()=>s(e));const c=()=>t.active.draggableId===e,v=()=>{var y;return((y=t.draggables[e])==null?void 0:y.transform)||P()};return Object.defineProperties((y,S)=>{const p=S?S():{};K(()=>{const w=i(),b=l(e);if(w)for(const a in b)w.addEventListener(a,b[a]);U(()=>{if(w)for(const a in b)w.removeEventListener(a,b[a])})}),u(y),p.skipTransform||K(()=>{const w=v();if(le(w,P()))y.style.removeProperty("transform");else{const b=te(v());y.style.setProperty("transform",b.transform??null)}})},{ref:{enumerable:!0,value:u},isActiveDraggable:{enumerable:!0,get:c},dragActivators:{enumerable:!0,get:()=>l(e,!0)},transform:{enumerable:!0,get:v}})},mt=(e,r={})=>{const[t,{addDroppable:o,removeDroppable:s}]=F(),[l,i]=R(null);H(()=>{const m=l();m&&o({id:e,node:m,layout:Y(m),data:r})}),U(()=>s(e));const u=()=>t.active.droppableId===e,c=()=>{var m;return((m=t.droppables[e])==null?void 0:m.transform)||P()};return Object.defineProperties((m,y)=>{const S=y?y():{};i(m),S.skipTransform||K(()=>{const p=c();if(le(p,P()))m.style.removeProperty("transform");else{const w=te(c());m.style.setProperty("transform",w.transform??null)}})},{ref:{enumerable:!0,value:i},isActiveDroppable:{enumerable:!0,get:u},transform:{enumerable:!0,get:c}})},bt=e=>{const[r,{onDragStart:t,onDragEnd:o,setOverlay:s,clearOverlay:l}]=F();let i;t(({draggable:c})=>{s({node:c.node,layout:c.layout}),queueMicrotask(()=>{if(i){const v=Y(i),m={x:(c.layout.width-v.width)/2,y:(c.layout.height-v.height)/2};v.x+=m.x,v.y+=m.y,s({node:i,layout:v})}})}),o(()=>queueMicrotask(l));const u=()=>{const c=r.active.overlay,v=r.active.draggable;return!c||!v?{}:{position:"fixed",transition:"transform 0s",top:`${c.layout.top}px`,left:`${c.layout.left}px`,"min-width":`${v.layout.width}px`,"min-height":`${v.layout.height}px`,...te(c.transform),...e.style}};return k(Te,{get mount(){return document.body},get children(){return k(Q,{get when(){return r.active.draggable},get children(){var c=nt(),v=i;return typeof v=="function"?Z(v,c):i=c,_(c,(()=>{var m=ye(()=>typeof e.children=="function");return()=>m()?e.children(r.active.draggable):e.children})()),q(m=>{var y=e.class,S=u();return y!==m.e&&ve(c,m.e=y),m.t=me(c,S,m.t),m},{e:void 0,t:void 0}),c}})}})},ft=(e,r,t)=>{const o=e.slice();return o.splice(t,0,...o.splice(r,1)),o},De=xe(),yt=e=>{const[r]=F(),[t,o]=he({initialIds:[],sortedIds:[]}),s=u=>u>=0&&u<t.initialIds.length;K(()=>{o("initialIds",[...e.ids]),o("sortedIds",[...e.ids])}),K(()=>{r.active.draggableId&&r.active.droppableId?O(()=>{const u=t.sortedIds.indexOf(r.active.draggableId),c=t.initialIds.indexOf(r.active.droppableId);if(!s(u)||!s(c))o("sortedIds",[...e.ids]);else if(u!==c){const v=ft(t.sortedIds,u,c);o("sortedIds",v)}}):o("sortedIds",[...e.ids])});const i=[t,{}];return k(De.Provider,{value:i,get children(){return e.children}})},ht=()=>pe(De)||null,xt=(e,r)=>t=>{e(t),r(t)},pt=(e,r={})=>{const[t,{addTransformer:o,removeTransformer:s}]=F(),[l]=ht(),i=vt(e,r),u=mt(e,r),c=xt(i.ref,u.ref),v=()=>l.initialIds.indexOf(e),m=()=>l.sortedIds.indexOf(e),y=a=>{var g;return((g=t.droppables[a])==null?void 0:g.layout)||null},S=()=>{const a=P(),g=v(),E=m();if(E!==g){const D=y(e),I=y(l.initialIds[E]);D&&I&&(a.x=I.x-D.x,a.y=I.y-D.y)}return a},p={id:"sortableOffset",order:100,callback:a=>{const g=S();return{x:a.x+g.x,y:a.y+g.y}}};H(()=>o("droppables",e,p)),U(()=>s("droppables",e,p.id));const w=()=>{var a,g;return(e===t.active.draggableId&&!t.active.overlay?(a=t.draggables[e])==null?void 0:a.transform:(g=t.droppables[e])==null?void 0:g.transform)||P()};return Object.defineProperties(a=>{i(a,()=>({skipTransform:!0})),u(a,()=>({skipTransform:!0})),K(()=>{const g=w();if(le(g,P()))a.style.removeProperty("transform");else{const E=te(w());a.style.setProperty("transform",E.transform??null)}})},{ref:{enumerable:!0,value:c},transform:{enumerable:!0,get:w},isActiveDraggable:{enumerable:!0,get:()=>i.isActiveDraggable},dragActivators:{enumerable:!0,get:()=>i.dragActivators},isActiveDroppable:{enumerable:!0,get:()=>u.isActiveDroppable}})},kt=N('<div class="sortable w-full">');const It=({id:e,children:r})=>{const t=pt(e),[o]=F();return(()=>{var s=kt();return Z(t,s,()=>!0),_(s,r),q(l=>{var i=!!t.isActiveDraggable,u=!!o.active.draggable;return i!==l.e&&s.classList.toggle("opacity-25",l.e=i),u!==l.t&&s.classList.toggle("transition-transform",l.t=u),l},{e:void 0,t:void 0}),s})()};var wt=N('<div class="column flex w-full flex-col gap-3 pb-24">'),Dt=N("<div class=sortable>"),$t=N('<div class="@container relative box-border flex h-full flex-col gap-2 p-3"><div class="box-border flex h-fit shrink-0 items-center gap-3"><div class="flex size-8 items-center justify-center rounded-lg text-xl"style="background:color-mix(in oklab, var(--accent-color), transparent 80%)"></div><h1 class="text-lg font-medium"></h1></div><div class="scrollbar-hidden box-border w-full flex-1 overflow-hidden overflow-y-auto pt-2">'),St=N('<div class="relative ml-auto flex gap-1"><button class="hover:bg-secondary-10 shrink-0 rounded p-1 active:scale-90"></button><div class=relative><button class="hover:bg-secondary-10 shtink-0 rounded p-1 active:scale-90">');const Ct=(e,r,t,o)=>(()=>{var s=$t(),l=s.firstChild,i=l.firstChild,u=i.nextSibling,c=l.nextSibling;return Pe(s,"contextmenu",r.handleContextMenu,!0),_(i,()=>e.meta().data.emoji),_(u,()=>e.kanban().name),_(l,k(_t,{get addItem(){return r.addItem},get showForm(){return r.showForm},get kanban(){return e.kanban()}}),null),_(c,k(dt,{get onDragStart(){return r.onDragStart},get onDragEnd(){return r.onDragEnd},collisionDetector:it,get children(){return[k(gt,{}),(()=>{var v=wt(),m=e.listDiv;return typeof m=="function"?Z(m,v):e.listDiv=v,_(v,k(yt,{get ids(){return e.kanban().items.map(y=>y.id)},get children(){return k(ge,{get each(){return e.kanban().items},children:y=>k(It,{get id(){return y.id},get children(){return k(at,{item:y,get updateItem(){return r.updateItem},removeItem:S=>{r.removeItem(S)},get accentColor(){return e.kanban().accent},get toolEvent(){return o==null?void 0:o.toolEvents},get cardName(){return t.card.data.name},get showForm(){return r.showForm},get selectedGroup(){return e.selectedGroup},get setSelectedGroup(){return e.setSelectedGroup}})}})})}})),v})(),k(bt,{get children(){var v=Dt();return _(v,k(Q,{get when(){return e.activeItem()},get children(){return k(Ie,{get item(){return e.kanban().items.find(m=>m.id==e.activeItem())},showBorderDivider:!1,get containerStyle(){return{width:e.listDiv.scrollWidth?`${e.listDiv.scrollWidth}px`:"100%","border-color":e.kanban().accent}}})}})),v}})]}})),q(v=>fe(s,"--accent-color",e.kanban().accent)),s})();function _t(e){let r;const t=()=>{e.showForm(o=>{B.events.emit("character-add-achievement","ðŸ§© Task Initiator"),e.addItem({...o,dates:{createdAt:new Date().toISOString()}})})};return(()=>{var o=St(),s=o.firstChild,l=s.nextSibling,i=l.firstChild,u=r;return typeof u=="function"?Z(u,o):r=o,s.$$click=t,_(s,k(ze,{class:"size-4"})),i.$$click=c=>r.dispatchEvent(new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,button:2,buttons:2,clientX:c.clientX,clientY:c.clientY})),_(i,k(Xe,{class:"size-4"})),o})()}be(["contextmenu","click"]);const Et=e=>({toolEvents:se.getSelf().getEvents()}),Pt=je({create:e=>{const r=Et(),t=Je(e,r),o=Qe(t,e,r);return{helper:r,state:t,logic:o,view:(s,l,i,u)=>Ct(s,l,i,u)}}});export{Pt as default};
